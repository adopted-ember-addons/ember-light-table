<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>addon/components/lt-body.js - Ember Light Table</title>
    <meta name="description" content="Lightweight, component based table for Ember 2.x">
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/custom.css">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="../assets/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../assets/css/theme.css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700' rel='stylesheet' type='text/css'>
    
</head>
<body>
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <a href="../" class="navbar-brand">
            <img src="../assets/img/ember-logo.png" alt="">
            <span>Light Table</span>
          </a>
        </div>

        <div class="collapse navbar-collapse" id="nav">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="https://github.com/offirgolan/ember-light-table" class="fa fa-github github"></a></li>
          </ul>
        </div>
      </div>
    </nav>
    <div id="main-wrapper" class="row">
        <div id="content-wrapper">
            <ol class="panel-group" id="sidebar" role="tablist" aria-multiselectable="true">
                <li class="panel panel-default">
                    <div class="panel-heading" role="tab" id="sidebar-search-heading">
                        <h4 class="panel-title">
                      <a role="button" data-toggle="collapse" href="#sidebar-search" aria-expanded="true" aria-controls="collapseOne">
                        Search
                      </a>
                    </h4>
                    </div>
                    <div id="sidebar-search" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="sidebar-search-heading">
                        <div class="panel-body">
                            <div id="api-tabview-filter">
                                <input type="search" id="api-filter" placeholder="Search...">
                            </div>
                        </div>
                    </div>
                </li>
                    <li class="panel panel-default">
                        <div class="panel-heading" role="tab" id="sidebar-version-heading">
                            <h4 class="panel-title">
                                <a role="button" href="https://github.com/offirgolan/ember-light-table/commits/v1.8.0" target="_blank">
                                  Tag: v1.8.0
                                </a>
                            </h4>
                        </div>
                    </li>
                <li class="panel panel-default">
                    <div class="panel-heading" role="tab" id="sidebar-modules-heading">
                        <h4 class="panel-title">
                    <a role="button" data-toggle="collapse" href="#sidebar-modules" aria-expanded="true" aria-controls="collapseOne">
                      Modules
                    </a>
                  </h4>
                    </div>
                    <div id="sidebar-modules" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="sidebar-modules-heading">
                        <div class="panel-body">
                                <ol>
                                        <li>
                                            <a href="../modules/Light Table.html">Light Table</a>
                                                    <li class="sub"><a href="../modules/Cell Types.html">Cell Types</a></li>
                                                    <li class="sub"><a href="../modules/Column Types.html">Column Types</a></li>
                                        </li>
                                        <li>
                                            <a href="../modules/Table.html">Table</a>
                                        </li>
                                        <li>
                                            <a href="../modules/Usage.html">Usage</a>
                                                    <li class="sub"><a href="../modules/Table Declaration.html">Table Declaration</a></li>
                                                    <li class="sub"><a href="../modules/Component Declaration.html">Component Declaration</a></li>
                                        </li>
                                </ol>
                        </div>
                    </div>
                </li>
            
                <li class="panel panel-default">
                    <div class="panel-heading" role="tab" id="sidebar-classes-heading">
                        <h4 class="panel-title">
                      <a role="button" data-toggle="collapse" href="#sidebar-classes" aria-expanded="true" aria-controls="collapseOne">
                        Classes
                      </a>
                    </h4>
                    </div>
                    <div id="sidebar-classes" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="sidebar-classes-heading">
                        <div class="panel-body">
                            <ol>
                                    <li>
                                        <a href="../classes/Base Cell.html">Base Cell</a>
                                    </li>
                                    <li>
                                        <a href="../classes/Base Column.html">Base Column</a>
                                    </li>
                                    <li>
                                        <a href="../classes/Column.html">Column</a>
                                    </li>
                                    <li>
                                        <a href="../classes/light-table.html">light-table</a>
                                    </li>
                                    <li>
                                        <a href="../classes/Row.html">Row</a>
                                    </li>
                                    <li>
                                        <a href="../classes/t.body.html">t.body</a>
                                    </li>
                                    <li>
                                        <a href="../classes/t.foot.html">t.foot</a>
                                    </li>
                                    <li>
                                        <a href="../classes/t.head.html">t.head</a>
                                    </li>
                                    <li>
                                        <a href="../classes/Table.html">Table</a>
                                    </li>
                            </ol>
                        </div>
                    </div>
                </li>
            </ol>
            <div class="content-container">
                <div class="apidocs">
                    <div id="docs-main">
                        <div class="content">
<div class="page-header">
    <h1><i class="fa fa-file-code-o" aria-hidden="true"></i> addon/components/lt-body.js File</h1>
</div>

<div class="file">
    <pre class="prettyprint linenums">
import Ember from &#x27;ember&#x27;;
import layout from &#x27;ember-light-table/templates/components/lt-body&#x27;;
import Row from &#x27;ember-light-table/classes/Row&#x27;;

const {
  Component,
  computed,
  run,
  observer
} = Ember;

/**
 * @module Light Table
 */

/**
 * &#x60;&#x60;&#x60;hbs
 * {{#light-table table as |t|}}
 *   {{#t.body multiSelect=true onRowClick=(action &#x27;rowClicked&#x27;)}}
 *     {{#body.expanded-row as |row|}}
 *       Hello &lt;b&gt;{{row.firstName}}&lt;/b&gt;
 *     {{/body.expanded-row}}
 *
 *     {{#if isLoading}}
 *       {{#body.loader}}
 *         Loading...
 *       {{/body.loader}}
 *     {{/if}}
 *
 *     {{#if table.isEmpty}}
 *       {{#body.no-data}}
 *         No users found.
 *       {{/body.no-data}}
 *     {{/if}}
 *   {{/t.body}}
 * {{/light-table}}
 * &#x60;&#x60;&#x60;
 *
 * @class t.body
 */

export default Component.extend({
  layout,
  classNames: [&#x27;lt-body-wrap&#x27;],
  classNameBindings: [&#x27;canSelect&#x27;, &#x27;multiSelect&#x27;, &#x27;canExpand&#x27;],

  /**
   * @property table
   * @type {Table}
   * @private
   */
  table: null,

  /**
   * @property sharedOptions
   * @type {Object}
   * @private
   */
  sharedOptions: null,

  /**
   * @property tableActions
   * @type {Object}
   */
  tableActions: null,

  /**
   * Allows a user to select a row on click. All this will do is apply the necessary
   * CSS classes and add the row to &#x60;table.selectedRows&#x60;. If &#x60;multiSelect&#x60; is disabled
   * only one row will be selected at a time.
   *
   * @property canSelect
   * @type {Boolean}
   * @default true
   */
  canSelect: true,

  /**
   * Select a row on click. If this is set to &#x60;false&#x60; and multiSelect is
   * enabled, using click + &#x60;shift&#x60;, &#x60;cmd&#x60;, or &#x60;ctrl&#x60; will still work as
   * intended, while clicking on the row will not set the row as selected.
   *
   * @property selectOnClick
   * @type {Boolean}
   * @default true
   */
  selectOnClick: true,

  /**
   * Allows for expanding row. This will create a new row under the row that was
   * clicked with the template provided by &#x60;body.expanded-row&#x60;.
   *
   * &#x60;&#x60;&#x60;hbs
   * {{#body.expanded-row as |row|}}
   *  This is the content of the expanded row for {{row.firstName}}
   * {{/body.expanded-row}}
   * &#x60;&#x60;&#x60;
   *
   * @property canExpand
   * @type {Boolean}
   * @default false
   */
  canExpand: false,

  /**
   * Allows a user to select multiple rows with the &#x60;ctrl&#x60;, &#x60;cmd&#x60;, and &#x60;shift&#x60; keys.
   * These rows can be easily accessed via &#x60;table.get(&#x27;selectedRows&#x27;)&#x60;
   *
   * @property multiSelect
   * @type {Boolean}
   * @default false
   */
  multiSelect: false,

  /**
   * When multiSelect is true, this property determines whether or not &#x60;ctrl&#x60;
   * (or &#x60;cmd&#x60;) is required to select additional rows, one by one. When false,
   * simply clicking on subsequent rows will select or deselect them.
   *
   * &#x60;shift&#x60; to select many consecutive rows is unaffected by this property.
   *
   * @property multiSelectRequiresKeyboard
   * @type {Boolean}
   * @default true
   */
  multiSelectRequiresKeyboard: true,

  /**
   * Hide scrollbar when not scrolling
   *
   * @property autoHideScrollbar
   * @type {Boolean}
   * @default true
   */
  autoHideScrollbar: true,

  /**
   * Allows multiple rows to be expanded at once
   *
   * @property multiRowExpansion
   * @type {Boolean}
   * @default true
   */
  multiRowExpansion: true,

  /**
   * Expand a row on click
   *
   * @property expandOnClick
   * @type {Boolean}
   * @default true
   */
  expandOnClick: true,

  /**
   * If true, the body block will yield columns and rows, allowing you
   * to define your own table body
   *
   * @property overwrite
   * @type {Boolean}
   * @default false
   */
  overwrite: false,

  /**
   * ID of main table component. Used to generate divs for ember-wormhole
   *
   * @property tableId
   * @type {String}
   * @private
   */
  tableId: null,

  /**
   * @property scrollBuffer
   * @type {Number}
   * @default 500
   */
  scrollBuffer: 500,

  /**
   * @property useVirtualScrollbar
   * @type {Boolean}
   * @default false
   * @private
   */
  useVirtualScrollbar: false,

  /**
   * Set this property to scroll to a specific px offset.
   *
   * This only works when &#x60;useVirtualScrollbar&#x60; is &#x60;true&#x60;, i.e. when you are
   * using fixed headers / footers.
   *
   * @property scrollTo
   * @type {Number}
   * @default null
   */
  scrollTo: null,
  _scrollTo: null,

  /**
   * Set this property to a &#x60;Row&#x60; to scroll that &#x60;Row&#x60; into view.
   *
   * This only works when &#x60;useVirtualScrollbar&#x60; is &#x60;true&#x60;, i.e. when you are
   * using fixed headers / footers.
   *
   * @property scrollToRow
   * @type {Row}
   * @default null
   */
  scrollToRow: null,
  _scrollToRow: null,

  /**
   * @property targetScrollOffset
   * @type {Number}
   * @default 0
   * @private
   */
  targetScrollOffset: 0,

  /**
   * @property currentScrollOffset
   * @type {Number}
   * @default 0
   * @private
   */
  currentScrollOffset: 0,

  /**
   * @property hasReachedTargetScrollOffset
   * @type {Boolean}
   * @default true
   * @private
   */
  hasReachedTargetScrollOffset: true,

  /**
   * Allows to customize the component used to render rows
   *
   * &#x60;&#x60;&#x60;hbs
   * {{#light-table table as |t|}}
   *    {{t.body rowComponent=(component &#x27;my-row&#x27;)}}
   * {{/light-table}}
   * &#x60;&#x60;&#x60;
   * @property rowComponent
   * @type {Ember.Component}
   * @default null
   */
  rowComponent: null,

  /**
   * Allows to customize the component used to render spanned rows
   *
   * &#x60;&#x60;&#x60;hbs
   * {{#light-table table as |t|}}
   *    {{t.body spannedRowComponent=(component &#x27;my-spanned-row&#x27;)}}
   * {{/light-table}}
   * &#x60;&#x60;&#x60;
   * @property spannedRowComponent
   * @type {Ember.Component}
   * @default null
   */
  spannedRowComponent: null,

  /**
   * Allows to customize the component used to render infinite loader
   *
   * &#x60;&#x60;&#x60;hbs
   * {{#light-table table as |t|}}
   *    {{t.body infinityComponent=(component &#x27;my-infinity&#x27;)}}
   * {{/light-table}}
   * &#x60;&#x60;&#x60;
   * @property infinityComponent
   * @type {Ember.Component}
   * @default null
   */
  infinityComponent: null,

  rows: computed.readOnly(&#x27;table.visibleRows&#x27;),
  columns: computed.readOnly(&#x27;table.visibleColumns&#x27;),
  colspan: computed.readOnly(&#x27;columns.length&#x27;),

  _prevSelectedIndex: -1,

  init() {
    this._super(...arguments);

    /*
      We can only set &#x60;useVirtualScrollbar&#x60; once all contextual components have
      been initialized since fixedHeader and fixedFooter are set on t.head and t.foot
      initialization.
     */
    run.once(this, this._setupVirtualScrollbar);
  },

  didReceiveAttrs() {
    this._super(...arguments);
    this.setupScrollOffset();
  },

  destroy() {
    this._super(...arguments);
    run.cancel(this._checkTargetOffsetTimer);
    run.cancel(this._setTargetOffsetTimer);
  },

  _setupVirtualScrollbar() {
    let { fixedHeader, fixedFooter } = this.get(&#x27;sharedOptions&#x27;);
    this.set(&#x27;useVirtualScrollbar&#x27;, fixedHeader || fixedFooter);
  },

  onRowsChange: observer(&#x27;rows.[]&#x27;, function() {
    this._checkTargetOffsetTimer = run.scheduleOnce(&#x27;afterRender&#x27;, this, this.checkTargetScrollOffset);
  }),

  setupScrollOffset() {
    let {
      scrollTo,
      _scrollTo,
      scrollToRow,
      _scrollToRow
    } = this.getProperties([&#x27;scrollTo&#x27;, &#x27;_scrollTo&#x27;, &#x27;scrollToRow&#x27;, &#x27;_scrollToRow&#x27;]);
    let targetScrollOffset = null;

    this.setProperties({ _scrollTo: scrollTo, _scrollToRow: scrollToRow });

    if (scrollTo !== _scrollTo) {
      targetScrollOffset = Number.parseInt(scrollTo, 10);

      if (Number.isNaN(targetScrollOffset)) {
        targetScrollOffset = null;
      }

      this.setProperties({
        targetScrollOffset,
        hasReachedTargetScrollOffset: targetScrollOffset &lt;= 0
      });
    } else if (scrollToRow !== _scrollToRow) {
      if (scrollToRow instanceof Row) {
        let rowElement = document.getElementById(scrollToRow.get(&#x27;rowId&#x27;));

        if (rowElement instanceof Element) {
          targetScrollOffset = rowElement.offsetTop;
        }
      }

      this.setProperties({ targetScrollOffset, hasReachedTargetScrollOffset: true });
    }
  },

  checkTargetScrollOffset() {
    if (!this.get(&#x27;hasReachedTargetScrollOffset&#x27;)) {
      let targetScrollOffset = this.get(&#x27;targetScrollOffset&#x27;);
      let currentScrollOffset = this.get(&#x27;currentScrollOffset&#x27;);

      if (targetScrollOffset &gt; currentScrollOffset) {
        this.set(&#x27;targetScrollOffset&#x27;, null);
        this._setTargetOffsetTimer = run.schedule(&#x27;render&#x27;, null, () =&gt; {
          this.set(&#x27;targetScrollOffset&#x27;, targetScrollOffset);
        });
      } else {
        this.set(&#x27;hasReachedTargetScrollOffset&#x27;, true);
      }
    }
  },

  toggleExpandedRow(row) {
    let multiRowExpansion = this.get(&#x27;multiRowExpansion&#x27;);
    let shouldExpand = !row.expanded;

    if (multiRowExpansion) {
      row.toggleProperty(&#x27;expanded&#x27;);
    } else {
      this.get(&#x27;table.expandedRows&#x27;).setEach(&#x27;expanded&#x27;, false);
      row.set(&#x27;expanded&#x27;, shouldExpand);
    }
  },

  actions: {
    /**
     * onRowClick action. Handles selection, and row expansion.
     * @event onRowClick
     * @param  {Row}   row The row that was clicked
     * @param  {Event}   event   The click event
     */
    onRowClick(row, e) {
      let rows = this.get(&#x27;table.rows&#x27;);
      let multiSelect = this.get(&#x27;multiSelect&#x27;);
      let multiSelectRequiresKeyboard = this.get(&#x27;multiSelectRequiresKeyboard&#x27;);
      let canSelect = this.get(&#x27;canSelect&#x27;);
      let selectOnClick = this.get(&#x27;selectOnClick&#x27;);
      let canExpand = this.get(&#x27;canExpand&#x27;);
      let expandOnClick = this.get(&#x27;expandOnClick&#x27;);
      let isSelected = row.get(&#x27;selected&#x27;);
      let currIndex = rows.indexOf(row);
      let prevIndex = this._prevSelectedIndex === -1 ? currIndex : this._prevSelectedIndex;

      this._prevSelectedIndex = currIndex;

      let toggleExpandedRow = () =&gt; {
        if (canExpand &amp;&amp; expandOnClick) {
          this.toggleExpandedRow(row);
        }
      };

      if (canSelect) {
        if (e.shiftKey &amp;&amp; multiSelect) {
          rows
            .slice(Math.min(currIndex, prevIndex), Math.max(currIndex, prevIndex) + 1)
            .forEach((r) =&gt; r.set(&#x27;selected&#x27;, !isSelected));
        } else if ((!multiSelectRequiresKeyboard || (e.ctrlKey || e.metaKey)) &amp;&amp; multiSelect) {
          row.toggleProperty(&#x27;selected&#x27;);
        } else {
          if (selectOnClick) {
            this.get(&#x27;table.selectedRows&#x27;).setEach(&#x27;selected&#x27;, false);
            row.set(&#x27;selected&#x27;, !isSelected);
          }

          toggleExpandedRow();
        }
      } else {
        toggleExpandedRow();
      }

      this.sendAction(&#x27;onRowClick&#x27;, ...arguments);
    },

    /**
     * onRowDoubleClick action.
     * @event onRowDoubleClick
     * @param  {Row}   row The row that was clicked
     * @param  {Event}   event   The click event
     */
    onRowDoubleClick(/* row */) {
      this.sendAction(&#x27;onRowDoubleClick&#x27;, ...arguments);
    },

    /**
     * onScroll action - sent when user scrolls
     *
     * This only works when &#x60;useVirtualScrollbar&#x60; is &#x60;true&#x60;, i.e. when you are
     * using fixed headers / footers.
     *
     * @event onScroll
     * @param {Number} scrollOffset The scroll offset in px
     * @param {Event} event The scroll event
     */
    onScroll(scrollOffset /* , event */) {
      this.set(&#x27;currentScrollOffset&#x27;, scrollOffset);
      this.sendAction(&#x27;onScroll&#x27;, ...arguments);
    },

    /**
     * onScrolledToBottom action - sent when user scrolls to the bottom
     *
     * @event onScrolledToBottom
     */
    onScrolledToBottom() {
      this.sendAction(&#x27;onScrolledToBottom&#x27;);
    }
  }
});

    </pre>
</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../assets/vendor/prettify/prettify-min.js"></script>
    <script>prettyPrint();</script>
    <script src="../assets/vendor/jquery/jquery.min.js"></script>
    <script src="../assets/vendor/jquery-ui/jquery-ui.min.js"></script>
    <script src="../assets/vendor/bootstrap/js/bootstrap.js"></script>
    <script src="../assets/vendor/github-slugger/slugger.js"></script>
    <script src="../assets/js/yuidoc-bootstrap.js"></script>
</body>
</html>
